<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>eDS-Checkpoint Report</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* ปิดการเลื่อน */
        }
        iframe {
            border: 0; /* ปิดขอบของ iframe */
            width: 100%;
            height: 100%;
            display: block; /* ปิดช่องว่างภายใน iframe */
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ดึง URL parameters ทั้งหมดจากหน้า testdes.html
            const urlParams = new URLSearchParams(window.location.search);

            // ดึง appsScriptUrl จาก parameter หรือใช้ค่า hardcode ถ้าไม่พบ
            // **สำคัญ: คุณต้องเปลี่ยน URL นี้ให้เป็น URL ของการ Deploy Apps Script ของคุณ**
            const appsScriptUrlParam = urlParams.get('appsScriptUrl');
            const appsScriptUrl = appsScriptUrlParam || "https://script.google.com/macros/s/AKfycbxY1XFudzOkfdieFcalmZyxCTeKutyL3Th-RKrc2WxCBT2AM8M9aYYzAGE0D3RaGp45bw/exec";

            let googleScriptUrl = appsScriptUrl;
            const paramsToPass = [];

            // ตรวจสอบและส่ง rowId (สำหรับ QR Code สแกนเพื่อสร้างรายการใหม่)
            const rowId = urlParams.get('rowId');
            if (rowId) {
                paramsToPass.push(`rowId=${rowId}`);
            }

            // ตรวจสอบและส่ง editRowId (สำหรับโหมดแก้ไขข้อมูลที่มีอยู่)
            const editRowId = urlParams.get('editRowId');
            if (editRowId) {
                paramsToPass.push(`editRowId=${editRowId}`);
            }

            // ส่ง spreadsheetId และ sheetName ไปด้วย (หาก Apps Script ต้องการใช้)
            const spreadsheetId = urlParams.get('spreadsheetId');
            if (spreadsheetId) {
                paramsToPass.push(`spreadsheetId=${spreadsheetId}`);
            }
            const sheetName = urlParams.get('sheetName');
            if (sheetName) {
                paramsToPass.push(`sheetName=${sheetName}`);
            }

            if (paramsToPass.length > 0) {
                googleScriptUrl += "?" + paramsToPass.join("&");
            }

            // กำหนด src ของ iframe ให้เป็น URL ที่สร้างขึ้นมา
            const iframe = document.getElementById('app');
            if (iframe) {
                iframe.src = googleScriptUrl;
            } else {
                console.error("ไม่พบ iframe ที่มี id 'app'");
            }
        });
    </script>
</head>
<body>
    <iframe
      id="app"
      src="" allow="geolocation"
      frameborder="0"
      scrolling="no">
    </iframe>
</body>
</html>
