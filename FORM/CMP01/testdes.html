<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>eDS-Checkpoint Report</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* ปิดการเลื่อน */
        }
        iframe {
            border: 0; /* ปิดขอบของ iframe */
            width: 100%;
            height: 100%;
            display: block; /* ปิดช่องว่างภายใน iframe */
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ดึง URL parameters จากหน้า testdes.html
            const urlParams = new URLSearchParams(window.location.search);
            const rowId = urlParams.get('rowId');
            const appsScriptUrlParam = urlParams.get('appsScriptUrl'); // ดึง appsScriptUrl จาก parameter

            // ใช้ appsScriptUrl ที่ส่งมา หรือ hardcode ถ้าไม่พบ
            const appsScriptUrl = appsScriptUrlParam || "https://script.google.com/macros/s/AKfycbxY1XFudzOkfdieFcalmZyxCTeKutyL3Th-RKrc2WxCBT2AM8M9aYYzAGE0D3RaGp45bw/exec"; 
            
            const mode = urlParams.get('mode') || 'new'; // ดึงโหมดการทำงาน (edit/new)

            // ตรวจสอบว่ามี rowId หรือไม่
            if (!rowId) {
                console.error("Missing rowId parameter.");
                // อาจแสดงข้อความแจ้งเตือนผู้ใช้ตรงนี้
                return;
            }

            // สร้าง URL สำหรับ Google Apps Script โดยแนบ parameters เข้าไปด้วย
            let googleScriptUrl = appsScriptUrl;

            const paramsToPass = [];
            paramsToPass.push(`mode=${mode}`); // ส่ง mode กลับไปให้ Apps Script
            paramsToPass.push(`rowId=${rowId}`);

            if (paramsToPass.length > 0) {
                googleScriptUrl += "?" + paramsToPass.join("&");
            }

            // กำหนด src ของ iframe ให้เป็น URL ที่สร้างขึ้นมา
            const iframe = document.getElementById('app');
            if (iframe) {
                iframe.src = googleScriptUrl;
            }
        });
    </script>
</head>
<body>
    <iframe
      id="app"
      src="" allow="geolocation"
      frameborder="0"
      scrolling="no">
    </iframe>
</body>
</html>
